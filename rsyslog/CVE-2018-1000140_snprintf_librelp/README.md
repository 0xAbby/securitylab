# Docker

To build and run the Dockerfile:

```
docker build . -t kev-rsyslog
docker network create -d bridge --subnet 172.25.0.0/16 kev-rsyslog-network
```

In terminal 1, start a container for the server:

```
docker run --network=kev-rsyslog-network --ip=172.25.0.10 -h rsyslog-server -i -t kev-rsyslog
```

If you want to use `gdb` to see the server crash, then start the server like this:

```
docker run --network=kev-rsyslog-network --ip=172.25.0.10 -h rsyslog-server --cap-add=SYS_PTRACE --security-opt seccomp=unconfined -i -t kev-rsyslog
```

In terminal 2, start a container for the benevolent client:

```
docker run --network=kev-rsyslog-network --ip=172.25.0.20 -h rsyslog-client -i -t kev-rsyslog
```

In the docker container for the benevolent client (terminal 1):

```
sudo rsyslogd -f benevolent/rsyslog-server.conf
```

In the docker container for the server (terminal 2), start the benevolent client:

```
sudo rsyslogd -f benevolent/rsyslog-client.conf
```

To see that the client has connected to the server:

```
sudo netstat -ntp
```

This will show something like this:

```
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp       90      0 172.25.0.20:38866       172.25.0.10:2514        ESTABLISHED 28/rsyslogd
```

In terminal 3, start a container for the malicious client:

```
docker run --network=kev-rsyslog-network --ip=172.25.0.30 -h rsyslog-client -i -t kev-rsyslog
```

In the docker container for the malicious client (terminal 3):

```
sudo rsyslogd -f malicious/rsyslog-client.conf
```


Instructions for using TLS with rsyslog:

https://www.rsyslog.com/using-tls-with-relp/
